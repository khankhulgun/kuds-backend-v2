import{cW as O,cX as b,cY as k,_ as y,cy as T,G as R,r as d,o as i,c as n,a as s,b as a,j as c,k as C,w as u,F as _,l as f,t as h,d as M}from"./entry.MJ5yZK23.js";import{m as D}from"./_mixin.h9E7hkPO.js";var U=/\{ *([\w_-]+) *\}/g;function I(e,o){return e.replace(U,function(g,p){var t=o[p];if(t===void 0)t="-------";else if(typeof t=="function")t=t(o);else if(typeof t=="string"&&t!==""&&(O(t)||b(t)))return k(t);return t})}const F={mixins:[D],components:{"a-modal":T},data(){return{preSource:[],modal_grid_show:!1,user_condition:null,selectedRow:{}}},computed:{value(){return this.model.form[this.model.component]},renderHtml(){return I(this.meta.GSOption.infoTemplate,this.selectedRow)}},watch:{value(e,o){(this.value===null||this.value===0||this.value==="")&&(this.selectedRow={}),e&&!o&&Object.keys(this.selectedRow).length==0&&this.callRowData()}},mounted(){this.meta.GSOption.sourceGridUserCondition!==void 0&&this.meta.GSOption.sourceGridUserCondition!==null&&this.meta.GSOption.sourceGridUserCondition!=""&&(this.user_condition=JSON.parse(this.meta.GSOption.sourceGridUserCondition))},methods:{callRowData(){let e={};e[this.meta.GSOption.sourceGridValueField]=this.value,R.post(`${this.sourceGridUrl()}/lambda/puzzle/grid/data/${this.meta.GSOption.sourceGridID}?&paginate=1&page=1&sort=id&order=desc`,e).then(({data:o})=>{o.data&&o.data.length>=1&&(this.selectedRow=o.data[0])})},onRowSelect(e){this.preSource=e},sourceGridUrl(){if(window.init)if(window.init.microserviceSettings){let e=window.init.microserviceSettings.findIndex(o=>o.project_id==this.meta.GSOption.sourceMicroserviceID);return e>=0?window.init.microserviceSettings[e].production_url:this.url}else return this.url;else return this.url},showAddSourceModal(){this.modal_grid_show=!0},closeSourceModal(){this.modal_grid_show=!1},addFromPreSource(){this.selectedRow={},this.preSource&&this.meta.GSOption.sourceGridTargetColumns&&this.preSource.length>=1&&(this.selectedRow=this.preSource[0],this.model.form[this.model.component]=this.selectedRow[this.meta.GSOption.sourceGridValueField]),this.closeSourceModal()}}},H={class:"subform-grid"},V={key:0,class:"relative"},j={class:"svg-icon"},A=["innerHTML"],L={border:"1"},N=s("th",{class:"action"},"...",-1),B={class:"action"},z={class:"svg-icon"},P={class:"form-modal source-grid",style:{height:"calc(100vh - 300px)"}},E={key:0,class:"form-body"},J={key:0,class:"source-grid-description"},W={key:0},X=["innerHTML"],Y={class:"add-from-pre-source"},q={class:"svg-icon"};function K(e,o,g,p,t,l){const m=d("inline-svg"),S=d("lambda-form-item"),G=d("datagrid"),w=d("a-button"),v=d("a-modal");return i(),n("div",H,[e.meta.GSOption.infoTemplate?(i(),n("div",V,[e.meta.disabled?c("",!0):(i(),n("a",{key:0,href:"javascript:void(0);",class:"link link-icon absolute right-0 top-0",onClick:o[0]||(o[0]=(...r)=>l.showAddSourceModal&&l.showAddSourceModal(...r))},[s("span",j,[a(m,{src:"/assets/icons/duotune/general/gen021.svg"})])])),s("div",{innerHTML:l.renderHtml},null,8,A)])):(i(),C(S,{key:1,label:e.label,name:e.model.component,meta:e.meta},{default:u(()=>[s("table",L,[s("thead",null,[s("tr",null,[(i(!0),n(_,null,f(e.meta.GSOption.sourceGridTargetColumns,r=>(i(),n("th",{key:r.index},h(r.label),1))),128)),N])]),s("tbody",null,[s("tr",null,[(i(!0),n(_,null,f(e.meta.GSOption.sourceGridTargetColumns,r=>(i(),n("td",{key:r.index},h(t.selectedRow[r.model]),1))),128)),s("td",B,[e.meta.disabled?c("",!0):(i(),n("a",{key:0,href:"javascript:void(0);",class:"link link-icon",onClick:o[1]||(o[1]=(...r)=>l.showAddSourceModal&&l.showAddSourceModal(...r))},[s("span",z,[a(m,{src:"/assets/icons/duotune/general/gen021.svg"})])]))])])])])]),_:1},8,["label","name","meta"])),a(v,{name:`grid-modal-${e.meta.GSOption.sourceGridID}`,open:t.modal_grid_show,"onUpdate:open":o[2]||(o[2]=r=>t.modal_grid_show=r),class:"form-modal",width:"85%",height:"85%",title:e.meta.GSOption.sourceGridModalTitle},{footer:u(()=>[s("div",Y,[a(w,{type:"success",onClick:l.addFromPreSource,disabled:t.preSource.length===0,class:"sub-form-add-btn"},{icon:u(()=>[s("span",q,[a(m,{src:"/assets/icons/duotune/general/gen041.svg"})])]),default:u(()=>[M("   Сонгох ")]),_:1},8,["onClick","disabled"])])]),default:u(()=>[s("section",P,[t.modal_grid_show?(i(),n("div",E,[e.meta.GSOption.sourceGridTitle||e.meta.GSOption.sourceGridDescription?(i(),n("div",J,[e.meta.GSOption.sourceGridTitle?(i(),n("h3",W,h(e.meta.GSOption.sourceGridTitle),1)):c("",!0),s("p",{innerHTML:e.meta.GSOption.sourceGridDescription},null,8,X)])):c("",!0),a(G,{schemaID:e.meta.GSOption.sourceGridID,url:l.sourceGridUrl(),onRowSelect:l.onRowSelect,paginate:50,hasSelection:!0,gridSelector:!0,user_condition:t.user_condition,permissions:{c:!1,r:!0,u:!1,d:!1}},null,8,["schemaID","url","onRowSelect","user_condition"])])):c("",!0)])]),_:1},8,["name","open","title"])])}const x=y(F,[["render",K]]);export{x as default};
