import{_ as M,cy as C,cZ as F,r as g,o as i,c as l,a as n,t as m,d as p,b as h,w as f,j as c,F as k,l as D,k as G,c_ as N,ao as E}from"./entry.MJ5yZK23.js";import{s as L,G as T}from"./subFormMix.nWugyTzT.js";const I={props:["form","model","editMode","relations","formula","url","viewMode"],mixins:[L],components:{"grid-form":T,"a-modal":C},mounted(){this.equationRenderer()},computed:{lang(){const t=["pleaseCompleteFirstLine"];return t.reduce((o,e,s)=>(o[e]=this.$t("dataForm."+t[s]),o),{})},subStyle(){return this.form.min_height?{minHeight:this.form.min_height+"px"}:{minHeight:"30px"}},Lang(){const t=["add"];return t.reduce((o,e,s)=>(o[e]=this.$t("dataForm."+t[s]),o),{})}},watch:{listData:{handler:function(t,o){this.hasEq&&this.equationData.map(e=>{if(e.hasEquation){e.data=-1;let s=0;switch(e.equation){case"SUM":{e.data=0,t.map(r=>{e.data+=Number(isNaN(parseInt(r.model[e.model],10))?0:r.model[e.model])});break}case"COUNT":{e.data=0,t.map(r=>{e.data+=1});break}case"MIN":{t.map(r=>{e.data==-1?e.data=r.model[e.model]:e.data=Math.min(e.data,r.model[e.model])});break}case"MAX":{e.data=0,t.map(r=>{e.data=Math.max(e.data,r.model[e.model])});break}case"AVG":{e.data=0,t.map(r=>{s++,e.data+=Number(r.model[e.model])}),e.data=Number(e.data/s);break}}}})},deep:!0}},data(){return{listData:[],equationData:[],currentSortDir:"asc",hasEq:!1,rowLength:0}},methods:{element:F,checkAddable(){return new Promise((t,o)=>{let e=this.listData[this.listData.length-1];if(e){let s=!1,r=e.model;for(let d in r)typeof r[d]!=null&&r[d]!=null&&r[d]!=""&&r[d]!=!1&&(s=!0);s?t(!0):(alert(this.lang.pleaseCompleteFirstLine),o(!1))}else t(!0)})},addSubForm(){let t=_.cloneDeep(this.form),o={};t.schema.forEach(s=>{t.identity==s.model||s.formType==null||t.timestamp&&(s.model=="created_at"||s.model=="updated_at")||(o[s.model]=s.default)});let e={form:t,model:o};this.model.form[this.model.component]==null&&(this.model.form[this.model.component]=[]),this.model.form[this.model.component].push(o),this.listData.push(e),this.rowLength=this.model.form[this.model.component].length},addSubFormWithData(t){let o=_.cloneDeep(this.form),e={...t},s={form:o,model:e};this.model.form[this.model.component]==null&&(this.model.form[this.model.component]=[]),this.model.form[this.model.component].push(e),this.listData.push(s),this.rowLength=this.model.form[this.model.component].length},add(){this.form.addFromGrid&&this.form.sourceGridID?this.showAddSourceModal():this.checkAddable().then(t=>{setTimeout(()=>{this.addSubForm()},200)}).catch(t=>{console.log(t)})},fillData(t){this.$nextTick(()=>{let o=[];t&&t.forEach(e=>{o.push({form:_.cloneDeep(this.form),model:e})}),this.listData=o})},equationRenderer(){this.equationData=[],this.form.schema.map(t=>{t.label!=""&&!t.hidden&&(t.hasEquation&&(this.hasEq=!0),this.equationData.push({hasEquation:t.hasEquation,equation:t.equations,prefix:t.prefix,model:t.model,preStaticWord:t.preStaticWord,data:0}))})},remove(t){this.model.form[this.form.model].splice(t,1),this.listData.splice(t,1),this.rowLength=this.model.form[this.model.component].length},reset(){this.model.form[this.form.model]=[],this.listData=[]},sort(t){let o=1;this.currentSortDir=this.currentSortDir==="asc"?"desc":"asc",this.currentSort=this.currentSortDir==="desc"?-1:1,this.currentSort=t.model,this.listData.sort((e,s)=>(this.currentSortDir==="desc"&&(o=-1),e.model[this.currentSort]<s.model[this.currentSort]?-1*o:e.model[this.currentSort]>s.model[this.currentSort]?1*o:0))}}},x={style:{display:"none"}},R={key:0,class:"subform-header"},V={class:"svg-icon"},W={border:"1"},A={key:0,class:"row-number"},z=["onClick"],B={class:"th-title"},H=n("i",{class:"ti-exchange-vertical"},null,-1),U={key:1,class:"action"},j=["onClick"],P={class:"svg-icon"},O={key:0},X={key:0},Z={key:1},J={key:2},K=n("td",null,null,-1),Q={class:"svg-icon"},Y={class:"form-modal source-grid",style:{height:"calc(100vh - 300px)"}},q={key:0,class:"form-body"},$={key:0,class:"source-grid-description"},ee={key:0},te=["innerHTML"],oe={class:"add-from-pre-source"},se={class:"svg-icon"};function ae(t,o,e,s,r,d){const b=g("inline-svg"),y=g("a-button"),S=g("grid-form"),v=g("datagrid"),w=g("a-modal");return i(),l("div",{class:"subform-grid",style:E(d.subStyle)},[n("h3",x,m(r.rowLength),1),!e.form.min_height&&!e.form.disableCreate&&!e.viewMode?(i(),l("div",R,[p(m(e.form.name)+" ",1),h(y,{shape:"circle",type:"success",size:"small",onClick:d.add,class:"sub-form-add-btn"},{icon:f(()=>[n("span",V,[h(b,{src:"/assets/icons/duotune/general/gen041.svg"})])]),_:1},8,["onClick"])])):c("",!0),n("table",W,[n("thead",null,[n("tr",null,[e.form.showRowNumber?(i(),l("th",A,"ДД")):c("",!0),(i(!0),l(k,null,D(e.form.schema.filter(a=>a.label!==""&&!a.hidden),a=>(i(),l("th",{onClick:u=>d.sort(a),key:a.index},[n("div",B,[p(m(a.label),1),H])],8,z))),128)),e.form.disableDelete?c("",!0):(i(),l("th",U,"..."))])]),n("tbody",null,[(i(!0),l(k,null,D(r.listData,(a,u)=>(i(),G(S,{key:u,rowIndex:u,f:a.form,model:a.model,editMode:e.editMode,relations:e.relations,url:e.url,schema:e.form.schema,formula:e.formula},N({_:2},[e.form.disableDelete?void 0:{name:"action",fn:f(()=>[n("a",{href:"javascript:void(0);",class:"btn btn-icon",onClick:re=>d.remove(u)},[n("span",P,[h(b,{src:"/assets/icons/duotone/General/Trash.svg"})])],8,j)]),key:"0"},e.form.showRowNumber?{name:"rowNumber",fn:f(()=>[n("span",null,m(u+1),1)]),key:"1"}:void 0]),1032,["rowIndex","f","model","editMode","relations","url","schema","formula"]))),128))]),r.hasEq?(i(),l("tfoot",O,[n("tr",null,[(i(!0),l(k,null,D(r.equationData,(a,u)=>(i(),l("td",{key:u},[a.preStaticWord!=null&&a.preStaticWord!=""?(i(),l("span",X,m(a.preStaticWord),1)):c("",!0),a.hasEquation?(i(),l("span",Z,m(a.data.toLocaleString()),1)):c("",!0),a.prefix!=null&&a.prefix!=""?(i(),l("span",J,m(a.prefix),1)):c("",!0)]))),128)),K])])):c("",!0)]),e.form.min_height&&!e.form.disableCreate&&!e.viewMode?(i(),l("a",{key:1,class:"sub-grid-add",href:"javascript:void(0)",onClick:o[0]||(o[0]=(...a)=>d.add&&d.add(...a))},[n("span",Q,[h(b,{src:"/assets/icons/duotune/general/gen041.svg"})]),p(" "+m(d.lang.add),1)])):c("",!0),h(w,{name:`grid-modal-${e.form.sourceGridID}`,open:t.modal_grid_show,"onUpdate:open":o[1]||(o[1]=a=>t.modal_grid_show=a),class:"form-modal",title:e.form.sourceGridModalTitle,"min-width":200,"min-height":100,"pivot-y":.5,adaptive:!0,reset:!0,draggable:!0,resizable:!0,width:"85%",height:"50%"},{footer:f(()=>[n("div",oe,[h(y,{type:"success",size:"small",onClick:t.addFromPreSource,disabled:t.preSource.length===0,class:"sub-form-add-btn"},{icon:f(()=>[n("span",se,[h(b,{src:"/assets/icons/duotune/general/gen041.svg"})])]),default:f(()=>[p(" Сонгох ")]),_:1},8,["onClick","disabled"])])]),default:f(()=>[n("section",Y,[t.modal_grid_show?(i(),l("div",q,[e.form.sourceGridTitle||e.form.sourceGridDescription?(i(),l("div",$,[e.form.sourceGridTitle?(i(),l("h3",ee,m(e.form.sourceGridTitle),1)):c("",!0),n("p",{innerHTML:e.form.sourceGridDescription},null,8,te)])):c("",!0),h(v,{schemaID:e.form.sourceGridID,url:t.sourceGridUrl(),onRowSelect:t.onRowSelect,paginate:50,hasSelection:!0,user_condition:t.user_condition,custom_condition:t.custom_condition,permissions:{c:!1,r:!0,u:!1,d:!1}},null,8,["schemaID","url","onRowSelect","user_condition","custom_condition"])])):c("",!0)])]),_:1},8,["name","open","title"])],4)}const le=M(I,[["render",ae]]);export{le as default};
